#!/usr/bin/env php
<?php

/**
 * @file
 * ORCA command line executable.
 */

use Consolidation\AnnotatedCommand\CommandFileDiscovery;
use Robo\Runner;

const ORCA_VERSION = 'v0.0.1';

// If invoked from a codebase that requires orca, i.e., a product module.
if (file_exists(__DIR__ . '/../../vendor/autoload.php')) {
  $class_loader = require __DIR__ . '/../../vendor/autoload.php';
  chdir(dirname(__DIR__ . '/../../../'));
}
// If invoked from a standalone orca instance, e.g., a development clone.
elseif (file_exists(__DIR__ . '/../vendor/autoload.php')) {
  $class_loader = require __DIR__ . '/../vendor/autoload.php';
  chdir(dirname(__DIR__ . '/../../'));
}
else {
  die("Could not find autoloader. Run 'composer install' first.\n");
}

$discovery = new CommandFileDiscovery();
$discovery->setSearchPattern('*Command.php');
$command_classes = $discovery->discover(__DIR__ . '/../src/Command', 'Acquia\Orca\Robo\Plugin\Commands');
$runner = new Runner($command_classes);
$runner->setClassLoader($class_loader);
$status_code = $runner->execute($_SERVER['argv'], 'ORCA', ORCA_VERSION);

exit($status_code);
