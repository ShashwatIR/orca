#!/usr/bin/env bash

# ORCA self test script.

set -e

# Locally perform the important steps from before_install, install, and
# before_script in .travis.yml.
if [ -z "${TRAVIS}" ]; then
  composer validate --ansi
  composer install
  composer phpcs
fi

# Clone the Acquia Purge module into place as a test SUT.
if [ ! -d "../lightning-api" ]; then
  git -C ../ clone git@github.com:acquia/lightning-api.git
fi

./bin/orca fixture:create --sut=drupal/lightning_api --sut-only --force
./bin/orca tests:run
./bin/orca fixture:reset -n --db
./bin/orca fixture:destroy -n
./bin/orca fixture:create

# Print script run times locally only.
[ -e "${TRAVIS}" ] || times
